name: Ping (crossfit-reservas-mvp ¬∑ 17:00‚Äì20:00 CL)

on:
  schedule:
    # Invierno CL (UTC-4): 17‚Äì19 = 21‚Äì23 UTC (cada 2 min)
    - cron: "*/2 21-23 * * *"
    # Verano CL (UTC-3): 17‚Äì19 = 20‚Äì22 UTC (cada 2 min)
    - cron: "*/2 20-22 * * *"
  workflow_dispatch: {}        # por si quieres probarlo manual

concurrency:
  group: ping-crossfit-reservas-mvp
  cancel-in-progress: true

jobs:
  ping:
    runs-on: ubuntu-latest
    env:
      URL: https://crossfit-reservas-mvp.fly.dev/health
    steps:
      - name: Ping con log y retry
        run: |
          export TZ=America/Santiago
          echo "üïí CL: $(date '+%Y-%m-%d %H:%M:%S')"
          echo "üåê $URL"
          for i in 1 2 3; do
            CODE=$(curl -o /dev/null -s -w '%{http_code}' "$URL")
            echo "Intento $i ‚Üí HTTP $CODE"
            # si ya respondi√≥ 2xx/3xx, suficiente
            if [ "$CODE" -ge 200 ] && [ "$CODE" -lt 400 ]; then
              exit 0
            fi
            sleep 10
          done
          # no fallamos el job aunque no llegue 200; igual despert√≥ la app
          exit 0